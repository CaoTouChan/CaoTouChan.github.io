<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Elasticsearch 实战（02）安装 —— ES / Kibana / Logstash</title>
  <meta name="description" content="Elasticsearch 安装和简单配置">
  <meta name="author" content="Wei Wang">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Elasticsearch 实战（02）安装 —— ES / Kibana / Logstash">
  <meta name="twitter:description" content="Elasticsearch 安装和简单配置">
  
  <meta property="og:type" content="article">
  <meta property="og:title" content="Elasticsearch 实战（02）安装 —— ES / Kibana / Logstash">
  <meta property="og:description" content="Elasticsearch 安装和简单配置">
  
  <link rel="icon" type="image/png" href="/assets/images/favicon.png" />
  <link href="/assets/images/favicon.png" rel="shortcut icon" type="image/png">
  
  <link rel="stylesheet" href="/css/main.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2019/06/ES-install/">
  <link rel="alternate" type="application/rss+xml" title="陈草头" href="http://localhost:4000/feed.xml">
  
  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  
</head>


  <body>

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>
    
    <header class="panel-cover panel-cover--collapsed" style="background-image: url('/assets/images/background-cover.jpg')">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/#blog" title="前往 陈草头 的主页" class="blog-button"><img src="/assets/images/avatar.jpg" width="80" alt="陈草头 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for 陈草头" class="blog-button">陈草头</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">越名教而任自然</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">90 后 | 广东人 | 现居住于帝都 | 算法攻城狮</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        
        <!-- 
        <p class="panel-cover__description"><a href="https://caotouchan.github.io" target="_blank">我的主页</a></p>
         -->
        
        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
                
              </ul>
            </nav>
          </div>
          
          <div><nav class="cover-navigation navigation--social">
  <ul class="navigation">

  
  <!-- Weibo -->
  <li class="navigation__item">
    <a href="http://weibo.com/lookka520" title="@lookka520 的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li>
  

  
  <!-- Github -->
  <li class="navigation__item">
    <a href="https://github.com/caotouchan" title="@caotouchan 的 Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>
  
  
  

  

  <!-- RSS -->
  <li class="navigation__item">
    <a href="/feed.xml" rel="author" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>

  
  <!-- Email -->
  <li class="navigation__item">
    <a href="mailto:caotouchan@outlook.com" title="Contact me">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>
  

  </ul>
</nav>
</div>
        </div>
      </div>
    </div>
    
    
    <div class="panel-cover--overlay cover-red"></div>
    
  </div>
</header>


    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2019-06-26 18:50:01 +0800" itemprop="datePublished" class="post-meta__date date">2019-06-26</time> &#8226; <span class="post-meta__tags tags"></span>
    </div>
    <h1 class="post-title">Elasticsearch 实战（02）安装 —— ES / Kibana / Logstash</h1>
  </header>

  <section class="post">
    <h2 id="elasticsearch-安装和简单配置">Elasticsearch 安装和简单配置</h2>

<p>ES 安装的地址请 <a href="https://www.elastic.co/cn/downloads/elasticsearch">点击这儿</a></p>

<p>ES 在 7.0 开始内置了 JAVA 环境，不需要像之前版本一样设置 $JAVA_HOME。</p>

<h3 id="目录结构">目录结构</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center">目录</th>
      <th style="text-align: center">配置</th>
      <th style="text-align: center">描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">bin</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">脚本文件，包括启动 ES、安装插件、运行统计数据等</td>
    </tr>
    <tr>
      <td style="text-align: center">config</td>
      <td style="text-align: center">elasticsearch.yml</td>
      <td style="text-align: center">集群配置文件，user 、role based 相关配置</td>
    </tr>
    <tr>
      <td style="text-align: center">JDK</td>
      <td style="text-align: center">path.data</td>
      <td style="text-align: center">JAVA 运行环境</td>
    </tr>
    <tr>
      <td style="text-align: center">data</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">数据文件</td>
    </tr>
    <tr>
      <td style="text-align: center">lib</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">JAVA 类库</td>
    </tr>
    <tr>
      <td style="text-align: center">log</td>
      <td style="text-align: center">path.log</td>
      <td style="text-align: center">日志文件</td>
    </tr>
    <tr>
      <td style="text-align: center">modules</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">包含所有 ES 模块</td>
    </tr>
    <tr>
      <td style="text-align: center">pliugin</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">包含素有已安装插件</td>
    </tr>
  </tbody>
</table>

<h3 id="jvm-配置">JVM 配置</h3>

<ul>
  <li>
    <p>修改 JVM  —— config/jvm.options</p>
  </li>
  <li>
    <p>配置建议：Xms 和 Xmx 配置成一样，不要超过机器内存的 50%，不要超过 30 GB</p>
  </li>
</ul>

<h3 id="测试">测试</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//启动单节点
bin/elasticsearch

//安装插件
bin/elasticsearch-plugin <span class="nb">install </span>analysis-icu
//查看插件
bin/elasticsearch-plugin list
//查看安装的插件
GET http://localhost:9200/_cat/plugins?v

// 本机启动多节点集群 （-d 表示后台运行）
bin/elasticsearch <span class="nt">-E</span> node.name<span class="o">=</span>node0 <span class="nt">-E</span> cluster.name<span class="o">=</span>geektime <span class="nt">-E</span> path.data<span class="o">=</span>node0_data <span class="nt">-d</span>
bin/elasticsearch <span class="nt">-E</span> node.name<span class="o">=</span>node1 <span class="nt">-E</span> cluster.name<span class="o">=</span>geektime <span class="nt">-E</span> path.data<span class="o">=</span>node1_data <span class="nt">-d</span>
bin/elasticsearch <span class="nt">-E</span> node.name<span class="o">=</span>node2 <span class="nt">-E</span> cluster.name<span class="o">=</span>geektime <span class="nt">-E</span> path.data<span class="o">=</span>node2_data <span class="nt">-d</span>
bin/elasticsearch <span class="nt">-E</span> node.name<span class="o">=</span>node3 <span class="nt">-E</span> cluster.name<span class="o">=</span>geektime <span class="nt">-E</span> path.data<span class="o">=</span>node3_data <span class="nt">-d</span>

//查看集群
GET http://localhost:9200

//查看nodes
GET _cat/nodes
GET _cluster/health
</code></pre></div></div>

<h2 id="kibana-安装">Kibana 安装</h2>

<p>Kibana 下载地址请 <a href="https://www.elastic.co/cn/downloads/kibana">点击这儿</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 启动 kibana
bin/kibana

// 插件
bin/kibana-plugin list
bin/kibana-plugin <span class="nb">install </span>plugin_location
bin/kibana remove

//查看
GET http://localhost:5601

</code></pre></div></div>

<h2 id="在-docker-中运行-eskibana-和-cerebro">在 Docker 中运行 ES、Kibana 和 Cerebro</h2>

<p>切换到你想要的文件夹，新建一个文件 <code class="highlighter-rouge">docker-compose.yaml</code> ，内容如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: <span class="s1">'2.2'</span>
services:
  cerebro:
    image: lmenezes/cerebro:0.8.3
    container_name: cerebro
    ports:
      - <span class="s2">"9000:9000"</span>
    <span class="nb">command</span>:
      - <span class="nt">-Dhosts</span>.0.host<span class="o">=</span>http://elasticsearch:9200
    networks:
      - es7net
  kibana:
    image: docker.elastic.co/kibana/kibana:7.1.0
    container_name: kibana7
    environment:
      - <span class="nv">I18N_LOCALE</span><span class="o">=</span>zh-CN
      - <span class="nv">XPACK_GRAPH_ENABLED</span><span class="o">=</span><span class="nb">true</span>
      - <span class="nv">TIMELION_ENABLED</span><span class="o">=</span><span class="nb">true</span>
      - <span class="nv">XPACK_MONITORING_COLLECTION_ENABLED</span><span class="o">=</span><span class="s2">"true"</span>
    ports:
      - <span class="s2">"5601:5601"</span>
    networks:
      - es7net
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.1.0
    container_name: es7_01
    environment:
      - cluster.name<span class="o">=</span>geektime
      - node.name<span class="o">=</span>es7_01
      - bootstrap.memory_lock<span class="o">=</span><span class="nb">true</span>
      - <span class="s2">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>
      - discovery.seed_hosts<span class="o">=</span>es7_01
      - cluster.initial_master_nodes<span class="o">=</span>es7_01,es7_02
    ulimits:
      memlock:
        soft: <span class="nt">-1</span>
        hard: <span class="nt">-1</span>
    volumes:
      - es7data1:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
    networks:
      - es7net
  elasticsearch2:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.1.0
    container_name: es7_02
    environment:
      - cluster.name<span class="o">=</span>geektime
      - node.name<span class="o">=</span>es7_02
      - bootstrap.memory_lock<span class="o">=</span><span class="nb">true</span>
      - <span class="s2">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span>
      - discovery.seed_hosts<span class="o">=</span>es7_01
      - cluster.initial_master_nodes<span class="o">=</span>es7_01,es7_02
    ulimits:
      memlock:
        soft: <span class="nt">-1</span>
        hard: <span class="nt">-1</span>
    volumes:
      - es7data2:/usr/share/elasticsearch/data
    networks:
      - es7net


volumes:
  es7data1:
    driver: <span class="nb">local
  </span>es7data2:
    driver: <span class="nb">local

</span>networks:
  es7net:
    driver: bridge
</code></pre></div></div>

<p>用 docker-compose 启动：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//启动
docker-compose up

//停止容器
docker-compose down

//停止容器并且移除数据
docker-compose down <span class="nt">-v</span>

</code></pre></div></div>

<h2 id="logstach-的安装和数据导入">Logstach 的安装和数据导入</h2>

<p>Logstash 下载地址请 <a href="https://www.elastic.co/cn/downloads/logstash">点击这儿</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//下载与ES相同版本号的logstash，并解压到相应目录
//修改movielens目录下的logstash.conf文件
//path修改为实际的movies.csv路径
input <span class="o">{</span>
  file <span class="o">{</span>
    path <span class="o">=&gt;</span> <span class="s2">"YOUR_FULL_PATH_OF_movies.csv"</span>
    start_position <span class="o">=&gt;</span> <span class="s2">"beginning"</span>
    sincedb_path <span class="o">=&gt;</span> <span class="s2">"/dev/null"</span>
  <span class="o">}</span>
<span class="o">}</span>

//启动Elasticsearch实例，然后启动 logstash，并制定配置文件导入数据
bin/logstash <span class="nt">-f</span> /YOUR_PATH_of_logstash.conf
</code></pre></div></div>

<h2 id="参考资料和相关阅读">参考资料和相关阅读</h2>

<ul>
  <li>
    <p>Elasticsearch核心技术与实战 （极客时间 阮一鸣） <a href="https://time.geekbang.org/course/intro/197">https://time.geekbang.org/course/intro/197</a></p>
  </li>
  <li>ES 安装 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html</a></li>
  <li>ES 配置 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html</a></li>
  <li>
    <p>ES 重要配置 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html</a></p>
  </li>
  <li>
    <p>初识 Kibana <a href="https://www.elastic.co/guide/en/kibana/current/setup.html">https://www.elastic.co/guide/en/kibana/current/setup.html</a></p>
  </li>
  <li>
    <p>Kibana 插件 <a href="https://www.elastic.co/guide/en/kibana/current/known-plugins.html">https://www.elastic.co/guide/en/kibana/current/known-plugins.html</a></p>
  </li>
  <li>Elasticsearch on Kuvernetes <a href="https://www.elastic.co/cn/blog/introducing-elastic-cloud-on-kubernetes-the-elasticsearch-operator-and-beyond">https://www.elastic.co/cn/blog/introducing-elastic-cloud-on-kubernetes-the-elasticsearch-operator-and-beyond</a></li>
  <li>
    <p>CAT Plugins API <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-plugins.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-plugins.html</a></p>
  </li>
  <li>
    <p>安装 Docker <a href="https://www.docker.com/products/docker-desktop">https://www.docker.com/products/docker-desktop</a></p>
  </li>
  <li>
    <p>安装 docker-compose <a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
  </li>
  <li>
    <p>如何创建自己的 Docker Image - <a href="https://www.elastic.co/cn/blog/how-to-make-a-dockerfile-for-elasticsearch">https://www.elastic.co/cn/blog/how-to-make-a-dockerfile-for-elasticsearch</a></p>
  </li>
  <li>
    <p>如何在为 Docker Image 安装 Elasticsearch 插件 - <a href="https://www.elastic.co/cn/blog/elasticsearch-docker-plugin-management">https://www.elastic.co/cn/blog/elasticsearch-docker-plugin-management</a></p>
  </li>
  <li>
    <p>如何设置 Docker 网络 - <a href="https://www.elastic.co/cn/blog/docker-networking">https://www.elastic.co/cn/blog/docker-networking</a></p>
  </li>
  <li>Cerebro 源码 <a href="https://github.com/lmenezes/cerebro">https://github.com/lmenezes/cerebro</a></li>
</ul>

  </section>
</article>

<section class="read-more">
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">最近的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2019/06/ES-ind-node/" title="link to Elasticsearch 实战（03）索引、文档、节点、分片">Elasticsearch 实战（03）索引、文档、节点、分片</a></h2>
       <p class="excerpt">如上图所示，文档和分片、索引和节点，其实从开发和运维的两个不同视角下的产物。和 RDBMS 的相关概念做一个不太准确的类比：            RDBMS      Elasticsearch                  table      index ( type )              row      document              column      field              schema      mapping           ...&hellip;</p>
       <div class="post-list__meta"><time datetime="2019-06-27 09:52:01 +0800" class="post-list__meta--date date">2019-06-27</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2019/06/ES-ind-node/>继续阅读</a></div>
   </div>
   
   
   
   
   <div class="read-more-item">
       <span class="read-more-item-dim">更早的文章</span>
       <h2 class="post-list__post-title post-title"><a href="/2019/06/ES-intro/" title="link to Elasticsearch 实战（01）综述">Elasticsearch 实战（01）综述</a></h2>
       <p class="excerpt">综述Elasticsearch 是一个分布式搜索引擎，可以实现大数据近实时分析，其高性能和易扩展、易使用性受到众多公司的青睐。这个系列文章基于 Elasticsearch 7.0 进行探索和实践，参考 极客时间的 《 Elasticsearch核心技术与实战 》 系列专栏。分布式架构集群规模可以从单个扩展到数百个节点，从服务和数据两个维度实现高可用和水平拓展。 ES 支持不用的节点类型，支持 Hot &amp; Warm 架构。集成方式      支持多种编程语言类库，如 Java/.NE...&hellip;</p>
       <div class="post-list__meta"><time datetime="2019-06-26 18:46:01 +0800" class="post-list__meta--date date">2019-06-26</time> &#8226; <span class="post-list__meta--tags tags"></span><a class="btn-border-small" href=/2019/06/ES-intro/>继续阅读</a></div>
   </div>
   
</section>

<section class="post-comments">
  

  

  <!-- Gitalk 评论 start  -->
  
  <!-- Link Gitalk 的支持文件  -->
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>

  <div id="gitalk-container"></div>
      <script type="text/javascript">
      var gitalk = new Gitalk({
          clientID: `6005df5e831456f4482b`,
          clientSecret: `ffc57d242198e14cdb68b7457a765d0b719415fb`,
          repo: `caotouchan.github.io`,
          owner: 'CaoTouChan',
          admin: ['CaoTouChan'],
          id: window.location.hash,
          distractionFreeMode: true,
      });
      gitalk.render('gitalk-container');
  </script>
  
  <!-- Gitalk end -->
  
  
  
</section>


            <section class="footer">
    <footer>
    	<span class="footer__copyright">本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享 署名-非商业性使用-相同方式共享 4.0 国际 许可协议</a></span>
        <span class="footer__copyright">由 <a href="https://jekyllrb.com">Jekyll</a> 于 2019-06-28 生成，感谢 <a href="https://www.digitalocean.com/?refcode=30ed2d146762">Digital Ocean</a> 为本站提供稳定的 VPS 服务</span>
        <span class="footer__copyright">本站由 <a href="https://caotouchan.github.io">@caotouchan</a> 创建，采用 <a href="https://github.com/onevcat/vno-jekyll">Vno - Jekyll</a> 作为主题，您可以在 GitHub 找到<a href="https://github.com/CaoTouChan/caotouchan.github.io">本站源码</a> - &copy; 2019</span>
    </footer>
</section>

        </div>
    </div>
    
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>

<script type="text/javascript" src="/js/main.js"></script>



    
  </body>

</html>
