<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>陈草头</title>
    <description>90 后 | 广东人 | 现居住于帝都 | 算法攻城狮</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 28 Jun 2019 10:23:42 +0800</pubDate>
    <lastBuildDate>Fri, 28 Jun 2019 10:23:42 +0800</lastBuildDate>
    <generator>Jekyll v3.8.5</generator>
    
      <item>
        <title>Elasticsearch 实战（04）CRUD 和批量操作</title>
        <description>&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ========== 创建文档 ===========&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# create document 自动生成 _id&lt;/span&gt;
POST &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_doc
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;user&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;Mike&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;post_date&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2019-04-15T14:12:12&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;trying out Kibana&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# create document 指定Id。如果id已经存在，报错&lt;/span&gt;
PUT &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_doc/1?op_type&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;create
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;user&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;Jack&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;post_date&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2019-05-15T14:12:12&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;trying out Elasticsearch&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# create document. 指定 ID 如果已经存在，就报错&lt;/span&gt;
PUT &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_create/1
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;s2&quot;&gt;&quot;user&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;Jack&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;post_date&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2019-05-15T14:12:12&quot;&lt;/span&gt;,
    &lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;trying out Elasticsearch&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ======== 通过 ID 获取文档 =============&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Get the document by ID&lt;/span&gt;
GET &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_doc/1


&lt;span class=&quot;c&quot;&gt;# ===========  Index &amp;amp; Update ===========&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Update 指定 ID  (先删除，在写入)&lt;/span&gt;
GET &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_doc/1

PUT &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_doc/1
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;user&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;Mike&quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;# GET users/_doc/1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#  在原文档上增加字段&lt;/span&gt;
POST &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_update/1/
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;doc&quot;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;post_date&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2019-05-15T14:12:12&quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;trying out Elasticsearch&quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;



&lt;span class=&quot;c&quot;&gt;# ======= 通过 ID 删除 ===========&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 删除文档&lt;/span&gt;
DELETE &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;/_doc/1


&lt;span class=&quot;c&quot;&gt;# ========= Bulk 操作 ===========&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 执行两次，查看每次的结果&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 执行第1次&lt;/span&gt;
POST _bulk
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;index&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field1&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;value1&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;delete&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;create&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test2&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;3&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field1&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;value3&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;update&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;doc&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field2&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;value2&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;# 执行第2次&lt;/span&gt;
POST _bulk
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;index&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field1&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;value1&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;delete&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;create&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test2&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;3&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field1&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;value3&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;update&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;doc&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field2&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;value2&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# =========== mget 操作 =============&lt;/span&gt;
GET /_mget
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;docs&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;# URI中指定index&lt;/span&gt;
GET /test/_mget
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;docs&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


GET /_mget
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;docs&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_source&quot;&lt;/span&gt; : &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;2&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_source&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;field3&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;field4&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;3&quot;&lt;/span&gt;,
            &lt;span class=&quot;s2&quot;&gt;&quot;_source&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;s2&quot;&gt;&quot;include&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
                &lt;span class=&quot;s2&quot;&gt;&quot;exclude&quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user.location&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ========== msearch 操作 ========&lt;/span&gt;
POST kibana_sample_data_ecommerce/_msearch
&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;match_all&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{}}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;size&quot;&lt;/span&gt;:1&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;index&quot;&lt;/span&gt; : &lt;span class=&quot;s2&quot;&gt;&quot;kibana_sample_data_flights&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;match_all&quot;&lt;/span&gt; : &lt;span class=&quot;o&quot;&gt;{}}&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;size&quot;&lt;/span&gt;:2&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c&quot;&gt;# ============ 清除测试数据 =========&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# 清除数据&lt;/span&gt;
DELETE &lt;span class=&quot;nb&quot;&gt;users
&lt;/span&gt;DELETE &lt;span class=&quot;nb&quot;&gt;test
&lt;/span&gt;DELETE test2

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
        <pubDate>Thu, 27 Jun 2019 11:52:01 +0800</pubDate>
        <link>http://localhost:4000/2019/06/ES-CRUD/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/06/ES-CRUD/</guid>
        
        
      </item>
    
      <item>
        <title>Elasticsearch 实战（03）索引、文档、节点、分片</title>
        <description>&lt;p&gt;&lt;img src=&quot;http://ww1.sinaimg.cn/large/006tNc79ly1g4g145kf5dj30qk0dwgmo.jpg&quot; alt=&quot;基本概念&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如上图所示，文档和分片、索引和节点，其实从开发和运维的两个不同视角下的产物。&lt;/p&gt;

&lt;p&gt;和 RDBMS 的相关概念做一个不太准确的类比：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;RDBMS&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Elasticsearch&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;table&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;index ( type )&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;row&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;document&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;column&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;field&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;schema&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;mapping&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;SQL&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;DSL&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;文档&quot;&gt;文档&lt;/h2&gt;

&lt;p&gt;文档是 ES 中所有可搜索数据的 &lt;strong&gt;最小单位&lt;/strong&gt;，比如：日志文件中的日志项、一张唱片的详情等。&lt;/p&gt;

&lt;p&gt;它会被序列化成 &lt;strong&gt;JSON&lt;/strong&gt; 格式 （ 无需预定格式、类型可以指定也可以自动推算、可嵌套，支持数组 ）。&lt;/p&gt;

&lt;p&gt;每个文档都有一个 &lt;strong&gt;Unique ID&lt;/strong&gt;，可以自己指定，也可以由 ES 自动生成。&lt;/p&gt;

&lt;p&gt;文档的元数据标注了文档相关信息：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;_index : 文档所属索引名
_type ： 文档所以类型名
_id ：文档唯一 id
_score ：相关性分数
_source : 文档原始 JSON
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;示例如下：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ww3.sinaimg.cn/large/006tNc79ly1g4g14tahrqj30nw0g20vc.jpg&quot; alt=&quot;文档&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;索引&quot;&gt;索引&lt;/h2&gt;

&lt;p&gt;索引是一类文档的集合，体现了逻辑空间的概念，有自己的 Mapping 定义，包含文档的字段名和字段类型。（分片体现的是物理空间的概念，索引中的数据分散在分片上）&lt;/p&gt;

&lt;p&gt;其中，索引的Mapping 定义文档字段的类型。&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&quot;mapping&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;@timestamp&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;alias&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;agent&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;fields&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;s2&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;keyword&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;s2&quot;&gt;&quot;ignore_above&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;bytes&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;long&quot;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Setting 定义了不同的数据分布。&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;settings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;index&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;number_of_shards&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;auto_expand_replicas&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;0-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;provided_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;kibana_sample_data_logs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;creation_date&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1561535052961&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;number_of_replicas&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;uuid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ZgZxux9QTfW4e-oVoP3ogA&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&quot;created&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;7010099&quot;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在 ES 7.0 之前，一个索引可以设置锁哥 Type，但是从 7.0 开始一个索引只能设置一个 Type —— 也就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;_doc&lt;/code&gt; 。&lt;/p&gt;

&lt;p&gt;7.0 弃用了接受类型的 API，引入了新的无类型 API，并移除了对 &lt;code class=&quot;highlighter-rouge&quot;&gt;_default_&lt;/code&gt; 映射的支持。&lt;/p&gt;

&lt;p&gt;8.0 将移除接受类型的 API。&lt;/p&gt;

&lt;h2 id=&quot;索引相关操作&quot;&gt;索引相关操作&lt;/h2&gt;

&lt;p&gt;Kibana 中管理索引的界面：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ww4.sinaimg.cn/large/006tNc79ly1g4g15epyy1j31mg0u0k10.jpg&quot; alt=&quot;Kibana操作&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在 Kibana 的 dev tools 下操作索引的相关 API ：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//查看索引相关信息
GET kibana_sample_data_logs

//查看索引的文档总数
GET kibana_sample_data_logs/_count

//查看前10条文档，了解文档格式
POST kibana_sample_data_logs/_search
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

//_cat indices API
//查看indices，使用通配符
GET /_cat/indices/kibana&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;?v&amp;amp;s&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;index

//查看状态为绿的索引
GET /_cat/indices?v&amp;amp;health&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;green

//按照文档个数排序
GET /_cat/indices?v&amp;amp;s&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;docs.count:desc

//查看具体的字段
GET /_cat/indices/kibana&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;?pri&amp;amp;v&amp;amp;h&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;health,index,pri,rep,docs.count,mt

//How much memory is used per index?
GET /_cat/indices?v&amp;amp;h&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;i,tm&amp;amp;s&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;tm:desc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;集群&quot;&gt;集群&lt;/h2&gt;

&lt;p&gt;ES 中不同集群通过不同名字区分，默认是 “elasticsearch”。通过配置文件或者命令行指定 &lt;code class=&quot;highlighter-rouge&quot;&gt;-E cluster.name=xxx&lt;/code&gt; 来指定。一个集群可以有一个或多个节点。&lt;/p&gt;

&lt;p&gt;集群的健康状态：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Green ：主分片和副本都分配正常
Yellow ：主分片正常，副本分片未能正常分配
Red ： 有主分片未能正常分配，例如服务器磁盘占用超过 85% 时试图创建索引
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;节点&quot;&gt;节点&lt;/h2&gt;

&lt;p&gt;节点时 ES 的一个实例，本质上是一个 JAVA 进程。一台机器可以运行多个 ES 进程，但工业环境一般一天机器只运行一个 ES 实例。&lt;/p&gt;

&lt;p&gt;每个节点都有一个名字，通过配置文件或者命令行  &lt;code class=&quot;highlighter-rouge&quot;&gt;-E node.name=xxx&lt;/code&gt; 指定。&lt;/p&gt;

&lt;p&gt;每个节点启动后会分配一个 ID，保存在 data 目录下。&lt;/p&gt;

&lt;h3 id=&quot;master-eligible-node-和-master-node&quot;&gt;Master-eligible node 和 Master node&lt;/h3&gt;

&lt;p&gt;每个节点启动后都会成为 Master-eligible node，可以参与选举成为 Master node，可以设置 &lt;code class=&quot;highlighter-rouge&quot;&gt;node.master=false&lt;/code&gt; 来禁止。&lt;/p&gt;

&lt;p&gt;只有 Master node 能修改集群信息。每个节点都保存了集群信息，包含：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;所有节点信息
所有索引和相关 Mapping 和 Setting
分片的路由信息
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;data-node-和-coordinating-node&quot;&gt;Data node 和 Coordinating node&lt;/h3&gt;

&lt;p&gt;Data node 保存分片的数据。&lt;/p&gt;

&lt;p&gt;Coordinating node 接受客户端请求，将请求分发得到结果后汇总。每个节点默认都有 Coordinating node 的职责。&lt;/p&gt;

&lt;h3 id=&quot;其他类型的-node&quot;&gt;其他类型的 node&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; Hot &amp;amp; Warm Node
 Machine Learning Node
 Tribe Node
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;节点配置&quot;&gt;节点配置&lt;/h3&gt;

&lt;p&gt;在生产环境中，每个节点都应该配置成 &lt;strong&gt;单一&lt;/strong&gt; 的节点类型。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;节点类型&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;配置参数&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;默认值&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;master eligible&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;node.master&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;true&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;data&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;node.data&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;true&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;ingest&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;node.ingest&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;true&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;coordinating only&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;无&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;每个节点默认都是 coordinating，设置其他类型为 false&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;machine learning&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;node.nl&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;true ( 需 enable x-pack )&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;分片&quot;&gt;分片&lt;/h2&gt;

&lt;p&gt;主分片 （ Primary Shard ）解决水平扩展，可以将数据分布到集群内所有节点。一个分片是一个 Lucene 实例。主分片数在在索引创建时指定，不允许修改（除非 reindex）。&lt;/p&gt;

&lt;p&gt;副本 （ Replica Shard ） 解决数据高可用，可以动态调整。&lt;/p&gt;

&lt;p&gt;以下是一个三节点集群的分片情况：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ww3.sinaimg.cn/large/006tNc79ly1g4g15wryeyj314a0eugnu.jpg&quot; alt=&quot;分片示例&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;集群节点相关操作&quot;&gt;集群、节点相关操作&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;get _cat/nodes?v
GET /_nodes/es7_01,es7_02
GET /_cat/nodes?v
GET /_cat/nodes?v&amp;amp;h&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;,ip,port,v,m


GET _cluster/health
GET _cluster/health?level&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;shards
GET /_cluster/health/kibana_sample_data_logs
GET /_cluster/health/kibana_sample_data_logs?level&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;shards

&lt;span class=&quot;c&quot;&gt;#### cluster state&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#### The cluster state API allows access to metadata representing the state of the whole cluster. This includes information such as&lt;/span&gt;
GET /_cluster/state

//cluster get settings
GET /_cluster/settings
GET /_cluster/settings?include_defaults&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true

&lt;/span&gt;GET _cat/shards
GET _cat/shards?h&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;index,shard,prirep,state,unassigned.reason
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;参考资料和相关阅读&quot;&gt;参考资料和相关阅读&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Elasticsearch核心技术与实战 （极客时间 阮一鸣） &lt;a href=&quot;https://time.geekbang.org/course/intro/197&quot;&gt;https://time.geekbang.org/course/intro/197&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;为什么不再支持单个Index下，多个Tyeps &lt;a href=&quot;https://www.elastic.co/cn/blog/moving-from-types-to-typeless-apis-in-elasticsearch-7-0&quot;&gt;https://www.elastic.co/cn/blog/moving-from-types-to-typeless-apis-in-elasticsearch-7-0&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;CAT Index API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-indices.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-indices.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;CAT Nodes API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-nodes.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-nodes.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Cluster API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cluster.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cluster.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;CAT Shards API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-shards.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-shards.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Thu, 27 Jun 2019 09:52:01 +0800</pubDate>
        <link>http://localhost:4000/2019/06/ES-ind-node/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/06/ES-ind-node/</guid>
        
        
      </item>
    
      <item>
        <title>Elasticsearch 实战（02）安装 —— ES / Kibana / Logstash</title>
        <description>&lt;h2 id=&quot;elasticsearch-安装和简单配置&quot;&gt;Elasticsearch 安装和简单配置&lt;/h2&gt;

&lt;p&gt;ES 安装的地址请 &lt;a href=&quot;https://www.elastic.co/cn/downloads/elasticsearch&quot;&gt;点击这儿&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ES 在 7.0 开始内置了 JAVA 环境，不需要像之前版本一样设置 $JAVA_HOME。&lt;/p&gt;

&lt;h3 id=&quot;目录结构&quot;&gt;目录结构&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;目录&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;配置&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;bin&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;脚本文件，包括启动 ES、安装插件、运行统计数据等&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;config&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;elasticsearch.yml&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;集群配置文件，user 、role based 相关配置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;JDK&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;path.data&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;JAVA 运行环境&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;data&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;数据文件&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;lib&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;JAVA 类库&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;log&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;path.log&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;日志文件&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;modules&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包含所有 ES 模块&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;pliugin&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt; &lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;包含素有已安装插件&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;jvm-配置&quot;&gt;JVM 配置&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;修改 JVM  —— config/jvm.options&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;配置建议：Xms 和 Xmx 配置成一样，不要超过机器内存的 50%，不要超过 30 GB&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;测试&quot;&gt;测试&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//启动单节点
bin/elasticsearch

//安装插件
bin/elasticsearch-plugin &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;analysis-icu
//查看插件
bin/elasticsearch-plugin list
//查看安装的插件
GET http://localhost:9200/_cat/plugins?v

// 本机启动多节点集群 （-d 表示后台运行）
bin/elasticsearch &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; node.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node0 &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; cluster.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;geektime &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; path.data&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node0_data &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
bin/elasticsearch &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; node.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node1 &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; cluster.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;geektime &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; path.data&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node1_data &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
bin/elasticsearch &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; node.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node2 &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; cluster.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;geektime &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; path.data&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node2_data &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
bin/elasticsearch &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; node.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node3 &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; cluster.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;geektime &lt;span class=&quot;nt&quot;&gt;-E&lt;/span&gt; path.data&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node3_data &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;

//查看集群
GET http://localhost:9200

//查看nodes
GET _cat/nodes
GET _cluster/health
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;kibana-安装&quot;&gt;Kibana 安装&lt;/h2&gt;

&lt;p&gt;Kibana 下载地址请 &lt;a href=&quot;https://www.elastic.co/cn/downloads/kibana&quot;&gt;点击这儿&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 启动 kibana
bin/kibana

// 插件
bin/kibana-plugin list
bin/kibana-plugin &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;plugin_location
bin/kibana remove

//查看
GET http://localhost:5601

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;在-docker-中运行-eskibana-和-cerebro&quot;&gt;在 Docker 中运行 ES、Kibana 和 Cerebro&lt;/h2&gt;

&lt;p&gt;切换到你想要的文件夹，新建一个文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose.yaml&lt;/code&gt; ，内容如下：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;version: &lt;span class=&quot;s1&quot;&gt;'2.2'&lt;/span&gt;
services:
  cerebro:
    image: lmenezes/cerebro:0.8.3
    container_name: cerebro
    ports:
      - &lt;span class=&quot;s2&quot;&gt;&quot;9000:9000&quot;&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;command&lt;/span&gt;:
      - &lt;span class=&quot;nt&quot;&gt;-Dhosts&lt;/span&gt;.0.host&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http://elasticsearch:9200
    networks:
      - es7net
  kibana:
    image: docker.elastic.co/kibana/kibana:7.1.0
    container_name: kibana7
    environment:
      - &lt;span class=&quot;nv&quot;&gt;I18N_LOCALE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zh-CN
      - &lt;span class=&quot;nv&quot;&gt;XPACK_GRAPH_ENABLED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
      - &lt;span class=&quot;nv&quot;&gt;TIMELION_ENABLED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
      - &lt;span class=&quot;nv&quot;&gt;XPACK_MONITORING_COLLECTION_ENABLED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;true&quot;&lt;/span&gt;
    ports:
      - &lt;span class=&quot;s2&quot;&gt;&quot;5601:5601&quot;&lt;/span&gt;
    networks:
      - es7net
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.1.0
    container_name: es7_01
    environment:
      - cluster.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;geektime
      - node.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es7_01
      - bootstrap.memory_lock&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
      - &lt;span class=&quot;s2&quot;&gt;&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;&lt;/span&gt;
      - discovery.seed_hosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es7_01
      - cluster.initial_master_nodes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es7_01,es7_02
    ulimits:
      memlock:
        soft: &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
        hard: &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
    volumes:
      - es7data1:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
    networks:
      - es7net
  elasticsearch2:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.1.0
    container_name: es7_02
    environment:
      - cluster.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;geektime
      - node.name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es7_02
      - bootstrap.memory_lock&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
      - &lt;span class=&quot;s2&quot;&gt;&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;&lt;/span&gt;
      - discovery.seed_hosts&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es7_01
      - cluster.initial_master_nodes&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;es7_01,es7_02
    ulimits:
      memlock:
        soft: &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
        hard: &lt;span class=&quot;nt&quot;&gt;-1&lt;/span&gt;
    volumes:
      - es7data2:/usr/share/elasticsearch/data
    networks:
      - es7net


volumes:
  es7data1:
    driver: &lt;span class=&quot;nb&quot;&gt;local
  &lt;/span&gt;es7data2:
    driver: &lt;span class=&quot;nb&quot;&gt;local

&lt;/span&gt;networks:
  es7net:
    driver: bridge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;用 docker-compose 启动：&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//启动
docker-compose up

//停止容器
docker-compose down

//停止容器并且移除数据
docker-compose down &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;logstach-的安装和数据导入&quot;&gt;Logstach 的安装和数据导入&lt;/h2&gt;

&lt;p&gt;Logstash 下载地址请 &lt;a href=&quot;https://www.elastic.co/cn/downloads/logstash&quot;&gt;点击这儿&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//下载与ES相同版本号的logstash，并解压到相应目录
//修改movielens目录下的logstash.conf文件
//path修改为实际的movies.csv路径
input &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  file &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    path &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;YOUR_FULL_PATH_OF_movies.csv&quot;&lt;/span&gt;
    start_position &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;beginning&quot;&lt;/span&gt;
    sincedb_path &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/dev/null&quot;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

//启动Elasticsearch实例，然后启动 logstash，并制定配置文件导入数据
bin/logstash &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /YOUR_PATH_of_logstash.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;参考资料和相关阅读&quot;&gt;参考资料和相关阅读&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Elasticsearch核心技术与实战 （极客时间 阮一鸣） &lt;a href=&quot;https://time.geekbang.org/course/intro/197&quot;&gt;https://time.geekbang.org/course/intro/197&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;ES 安装 &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;ES 配置 &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ES 重要配置 &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/important-settings.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;初识 Kibana &lt;a href=&quot;https://www.elastic.co/guide/en/kibana/current/setup.html&quot;&gt;https://www.elastic.co/guide/en/kibana/current/setup.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Kibana 插件 &lt;a href=&quot;https://www.elastic.co/guide/en/kibana/current/known-plugins.html&quot;&gt;https://www.elastic.co/guide/en/kibana/current/known-plugins.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Elasticsearch on Kuvernetes &lt;a href=&quot;https://www.elastic.co/cn/blog/introducing-elastic-cloud-on-kubernetes-the-elasticsearch-operator-and-beyond&quot;&gt;https://www.elastic.co/cn/blog/introducing-elastic-cloud-on-kubernetes-the-elasticsearch-operator-and-beyond&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;CAT Plugins API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-plugins.html&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/7.1/cat-plugins.html&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;安装 Docker &lt;a href=&quot;https://www.docker.com/products/docker-desktop&quot;&gt;https://www.docker.com/products/docker-desktop&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;安装 docker-compose &lt;a href=&quot;https://docs.docker.com/compose/install/&quot;&gt;https://docs.docker.com/compose/install/&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;如何创建自己的 Docker Image - &lt;a href=&quot;https://www.elastic.co/cn/blog/how-to-make-a-dockerfile-for-elasticsearch&quot;&gt;https://www.elastic.co/cn/blog/how-to-make-a-dockerfile-for-elasticsearch&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;如何在为 Docker Image 安装 Elasticsearch 插件 - &lt;a href=&quot;https://www.elastic.co/cn/blog/elasticsearch-docker-plugin-management&quot;&gt;https://www.elastic.co/cn/blog/elasticsearch-docker-plugin-management&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;如何设置 Docker 网络 - &lt;a href=&quot;https://www.elastic.co/cn/blog/docker-networking&quot;&gt;https://www.elastic.co/cn/blog/docker-networking&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Cerebro 源码 &lt;a href=&quot;https://github.com/lmenezes/cerebro&quot;&gt;https://github.com/lmenezes/cerebro&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 26 Jun 2019 18:50:01 +0800</pubDate>
        <link>http://localhost:4000/2019/06/ES-install/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/06/ES-install/</guid>
        
        
      </item>
    
      <item>
        <title>Elasticsearch 实战（01）综述</title>
        <description>&lt;h2 id=&quot;综述&quot;&gt;综述&lt;/h2&gt;

&lt;p&gt;Elasticsearch 是一个分布式搜索引擎，可以实现大数据近实时分析，其高性能和易扩展、易使用性受到众多公司的青睐。&lt;/p&gt;

&lt;p&gt;这个系列文章基于 Elasticsearch 7.0 进行探索和实践，参考 极客时间的 《 Elasticsearch核心技术与实战 》 系列专栏。&lt;/p&gt;

&lt;h2 id=&quot;分布式架构&quot;&gt;分布式架构&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://ww2.sinaimg.cn/large/006tNc79ly1g4fyr77qigj30fb0bv74n.jpg&quot; alt=&quot;分布式架构&quot; /&gt;&lt;/p&gt;

&lt;p&gt;集群规模可以从单个扩展到数百个节点，从服务和数据两个维度实现高可用和水平拓展。 ES 支持不用的节点类型，支持 Hot &amp;amp; Warm 架构。&lt;/p&gt;

&lt;h2 id=&quot;集成方式&quot;&gt;集成方式&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;支持多种编程语言类库，如 Java/.NET/Python/PHP/Perl etc.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;RESTful API （推荐） 和 Transport API&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;JDBC &amp;amp; ODBC&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;版本对比&quot;&gt;版本对比&lt;/h2&gt;

&lt;h3 id=&quot;5x-新特性&quot;&gt;5.x 新特性&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;基于 Lucene 6.x，默认打分从 TF-IDF 改为 BM25&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;支持 Ingest 节点、Painless Scripting、Completion suggestion&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Type 标记成 deprecated， 支持 Keyword 类型&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Instant aggregation，支持分片上聚合的缓存&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;新增 Profile API&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;6x-新特性&quot;&gt;6.x 新特性&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;基于 Lucene 7.x&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;支持跨集群复制 （CCR）、索引生命周期管理、SQL&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;数据迁移优化&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;优化稀疏字段存储&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;索引时进行排序，加快查询&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;7x-新特性&quot;&gt;7.x 新特性&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;基于 Lucene 8.0，正式废除单索引多 Type 的支持&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Security 功能免费&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ECK —— Elasticsearch Operator on Kubernetes&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;New Cluster coordination&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Feature-Complete High Level REST Client&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Script Score Query&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;默认 Primary Shard 从 5 变成 1&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;产品生态圈&quot;&gt;产品生态圈&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://ww3.sinaimg.cn/large/006tNc79ly1g4fyu8h14oj30k00a1755.jpg&quot; alt=&quot;产品生态圈&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Logstash ：开源服务器端数据处理管道，支持不同来源的数据采集、转换、存储，实现解析和转换数据，可拓展（插件安装，Log、DB、Arcsign、Netflow），可靠性，数据传输加密、监控&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Kibana ： 数据可视化&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;BEATS ： 轻量的数据采集器&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;X-Pack ： 商业化套件，OSS、Basic、黄金级、白金级，基础班免费&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;应用场景&quot;&gt;应用场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;搜索类 ：集成数据库同步数据、不推荐作为独立数据存储使用&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;日志类 ： Logstash 和 Beats 满足不用的数据源， Kafka 作为消息队列&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://ww1.sinaimg.cn/large/006tNc79ly1g4fyurnrqfj30ij09hmyy.jpg&quot; alt=&quot;日志类技术栈&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;参考链接与相关阅读&quot;&gt;参考链接与相关阅读&lt;/h2&gt;

&lt;p&gt;[1] Elasticsearch核心技术与实战 （极客时间 阮一鸣）&lt;a href=&quot;https://time.geekbang.org/course/intro/197&quot;&gt;https://time.geekbang.org/course/intro/197&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[2] Elasticsearch Certification &lt;a href=&quot;https://www.elastic.co/cn/training/certification&quot;&gt;https://www.elastic.co/cn/training/certification&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[3] ElasticSearch Engineering I training &lt;a href=&quot;https://www.elastic.co/cn/training/elasticsearch-engineer-1&quot;&gt;https://www.elastic.co/cn/training/elasticsearch-engineer-1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[4] ElasticSearch Engineering II training &lt;a href=&quot;https://www.elastic.co/cn/training/elasticsearch-engineer-2&quot;&gt;https://www.elastic.co/cn/training/elasticsearch-engineer-2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[5] ES 7.0 发布 &lt;a href=&quot;https://www.elastic.co/blog/elasticsearch-7-0-0-released&quot;&gt;https://www.elastic.co/blog/elasticsearch-7-0-0-released&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[6] X-Pack 开源 &lt;a href=&quot;https://www.elastic.co/products/x-pack/open&quot;&gt;https://www.elastic.co/products/x-pack/open&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[7] 用户案例 &lt;a href=&quot;https://www.elastic.co/cn/use-cases/&quot;&gt;https://www.elastic.co/cn/use-cases/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[8] Top 5 Elasticsearch Use Cases &lt;a href=&quot;https://www.objectrocket.com/blog/elasticsearch/top-elasticsearch-use-cases/&quot;&gt;https://www.objectrocket.com/blog/elasticsearch/top-elasticsearch-use-cases/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[9] Elastic Stack — A Brief Introduction &lt;a href=&quot;https://hackernoon.com/elastic-stack-a-brief-introduction-794bc7ff7d4f&quot;&gt;https://hackernoon.com/elastic-stack-a-brief-introduction-794bc7ff7d4f&lt;/a&gt;&lt;/p&gt;

</description>
        <pubDate>Wed, 26 Jun 2019 18:46:01 +0800</pubDate>
        <link>http://localhost:4000/2019/06/ES-intro/</link>
        <guid isPermaLink="true">http://localhost:4000/2019/06/ES-intro/</guid>
        
        
      </item>
    
      <item>
        <title>搜索</title>
        <description>&lt;div&gt;
    &lt;form id=&quot;cloudsh&quot;&gt;
      &lt;input type=&quot;text&quot; id=&quot;q&quot;/&gt;
      &lt;button&gt;Search&lt;/button&gt;
    &lt;/form&gt;
    &lt;div id=&quot;results&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;https://app.cloudsh.com/js/cloudsh.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
    var CshConf = {
        token: &quot;eyJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiNWYzOGI3NDItYTRmZi00NWJiLWFlZTgtODg4NGIwMTgyYmViIiwiaW5kZXhfaWQiOiIzYWVmMTJkNC03NmI5LTQxODUtODgwZi04ODIzZWQ4ZDk2OWMiLCJpbmRleF91cmwiOiJodHRwOi8vY2FvdG91Y2hhbi5naXRodWIuaW8ifQ.7DenpSaI57JdUWcOBzjgigt0nSqP9yOCADxh6msquHk&quot;,
        formId: &quot;#cloudsh&quot;,
        resultsId: &quot;#results&quot;,
    };
    &lt;/script&gt;
&lt;/div&gt;</description>
        <pubDate>Thu, 01 Jun 2000 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/2000/06/search/</link>
        <guid isPermaLink="true">http://localhost:4000/2000/06/search/</guid>
        
        
      </item>
    
  </channel>
</rss>
